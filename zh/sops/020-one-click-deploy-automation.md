# ä¸€é”®å‘å¸ƒï¼šä»ä»£ç æäº¤åˆ°çº¿ä¸Šçš„å…¨è‡ªåŠ¨åŒ–å®è·µ

> å¦‚ä½•è®© Web3 é¡¹ç›®çš„å‘å¸ƒæµç¨‹ä»ã€Œæ‰‹å¿™è„šä¹±ã€å˜æˆã€Œå–æ¯å’–å•¡çš„æ—¶é—´ã€

**æ–‡æ¡£ç¼–å·**: 020
**æ—¥æœŸ**: 2025-01-01
**æ ‡ç­¾**: `DevOps` `è‡ªåŠ¨åŒ–` `Hardhat` `Firebase` `Web3`

---

## æ¦‚è¿°

å¦‚æœä½ æ˜¯ä¸€ä¸ª DeFi é¡¹ç›®çš„å¼€å‘è€…ï¼Œä½ ä¸€å®šç»å†è¿‡è¿™æ ·çš„åœºæ™¯ï¼š

å‡Œæ™¨ 2 ç‚¹ï¼Œä½ ç»ˆäºæ”¹å®Œäº†ä¸€ä¸ªç´§æ€¥ bugã€‚æ¥ä¸‹æ¥ä½ éœ€è¦ï¼š
1. éƒ¨ç½²åˆçº¦åˆ°æµ‹è¯•ç½‘éªŒè¯
2. æ›´æ–°å‰ç«¯çš„åˆçº¦åœ°å€é…ç½®
3. é‡æ–°æ‰“åŒ…å‰ç«¯é¡¹ç›®
4. éƒ¨ç½²åˆ°æ‰˜ç®¡æœåŠ¡
5. åœ¨ç¾¤é‡Œé€šçŸ¥å›¢é˜Ÿ
6. å†™ä¸€ä»½å˜æ›´è¯´æ˜æ–‡æ¡£

ç­‰ä½ åšå®Œè¿™ä¸€åˆ‡ï¼Œå¤©å·²ç»äº®äº†ã€‚

è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ¥èŠèŠå¦‚ä½•æŠŠè¿™ä¸ªè¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Œè®©å‘å¸ƒå˜æˆä¸€ä»¶ã€Œä¸€é”®å®Œæˆã€çš„äº‹æƒ…ã€‚

---

## æˆ‘ä»¬è¦è§£å†³ä»€ä¹ˆé—®é¢˜

ä¸€ä¸ªå…¸å‹çš„ Web3 é¡¹ç›®å‘å¸ƒæµç¨‹åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

```
ä»£ç æäº¤ â†’ åˆçº¦éƒ¨ç½² â†’ é…ç½®æ›´æ–° â†’ å‰ç«¯æ‰“åŒ… â†’ ç¯å¢ƒå‘å¸ƒ â†’ æ–‡æ¡£ç”Ÿæˆ â†’ å›¢é˜Ÿé€šçŸ¥
```

æ¯ä¸ªæ­¥éª¤éƒ½æœ‰å¯èƒ½å‡ºé”™ï¼š
- åˆçº¦éƒ¨ç½²æ—¶ gas ä¼°ç®—å¤±è´¥
- å‰ç«¯é…ç½®å¿˜è®°æ›´æ–°åˆçº¦åœ°å€
- æ‰“åŒ…æ—¶é—æ¼äº†ç¯å¢ƒå˜é‡
- å‘å¸ƒåå¿˜è®°é€šçŸ¥å›¢é˜Ÿ
- æ–‡æ¡£å’Œå®é™…ç‰ˆæœ¬ä¸ä¸€è‡´

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼š**æŠŠè¿™äº›æ­¥éª¤ä¸²è”æˆä¸€ä¸ªå¯é çš„è‡ªåŠ¨åŒ–æµç¨‹ï¼Œå‡å°‘äººä¸ºå¤±è¯¯ï¼Œæå‡å‘å¸ƒæ•ˆç‡ã€‚**

---

## æŠ€æœ¯æ¶æ„

å…¸å‹çš„ DeFi é¡¹ç›®ä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯æ ˆï¼š

| å±‚çº§ | æŠ€æœ¯é€‰å‹ |
|------|----------|
| æ™ºèƒ½åˆçº¦ | Solidity + Hardhat + hardhat-deploy |
| å‰ç«¯åº”ç”¨ | React + Vite + Wagmi + Viem |
| éƒ¨ç½²æ‰˜ç®¡ | Firebase Hosting / Vercel |
| æ–‡æ¡£ç®¡ç† | Notion API |
| å›¢é˜Ÿé€šçŸ¥ | Telegram Bot |

æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Hardhat  â”‚ â†’ â”‚ Post     â”‚ â†’ â”‚ Vite     â”‚ â†’ â”‚ Hosting  â”‚  â”‚
â”‚  â”‚ Deploy   â”‚    â”‚ Deploy   â”‚    â”‚ Build    â”‚    â”‚ Deploy   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                               â”‚         â”‚
â”‚       â†“                                               â†“         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ åˆçº¦éªŒè¯  â”‚                                   â”‚ Notion   â”‚   â”‚
â”‚  â”‚ (å¯é€‰)   â”‚                                   â”‚ + TG Bot â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒå®ç°

### 1. åˆçº¦éƒ¨ç½²è‡ªåŠ¨åŒ–

æˆ‘ä»¬ä½¿ç”¨ `hardhat-deploy` æ’ä»¶ç®¡ç†åˆçº¦éƒ¨ç½²ã€‚å…³é”®åœ¨äº**å¹‚ç­‰æ€§**â€”â€”æ— è®ºè¿è¡Œå¤šå°‘æ¬¡ï¼Œç»“æœéƒ½æ˜¯ä¸€è‡´çš„ã€‚

```typescript
// deploy/002_deploy_token_staking.ts
const func: DeployFunction = async function (hre: HardhatRuntimeEnvironment) {
  const { deployments, getNamedAccounts } = hre;
  const { deploy } = deployments;
  const { deployer } = await getNamedAccounts();

  // ä½¿ç”¨ Transparent Proxy æ¨¡å¼éƒ¨ç½²
  await deploy('TokenStaking', {
    from: deployer,
    proxy: {
      proxyContract: 'TransparentUpgradeableProxy',
      execute: {
        init: {
          methodName: 'initialize',
          args: [stakingToken, rewardToken, dailyReward],
        },
      },
    },
    log: true,
    waitConfirmations: 5, // Polygon å»ºè®®ç­‰å¾… 5 ä¸ªç¡®è®¤
  });
};
```

**å…³é”®ç‚¹ï¼š**
- ä½¿ç”¨ `TransparentUpgradeableProxy` å®ç°å¯å‡çº§åˆçº¦
- è®¾ç½®è¶³å¤Ÿçš„ `waitConfirmations` ç¡®ä¿äº¤æ˜“è¢«ç¡®è®¤
- éƒ¨ç½²è„šæœ¬å…·æœ‰å¹‚ç­‰æ€§ï¼Œé‡å¤è¿è¡Œä¸ä¼šé‡å¤éƒ¨ç½²

### 2. é…ç½®è‡ªåŠ¨åŒæ­¥

åˆçº¦éƒ¨ç½²å®Œæˆåï¼Œéœ€è¦è‡ªåŠ¨æ›´æ–°å‰ç«¯çš„åˆçº¦åœ°å€é…ç½®ã€‚æˆ‘ä»¬é€šè¿‡ `post-deploy` è„šæœ¬å®ç°ï¼š

```typescript
// deploy/999_post_deploy.ts
const func: DeployFunction = async function (hre: HardhatRuntimeEnvironment) {
  const { deployments } = hre;
  const chainId = await hre.getChainId();

  // è¯»å–å·²éƒ¨ç½²çš„åˆçº¦åœ°å€
  const staking = await deployments.get('TokenStaking');
  const stakingToken = await deployments.get('StakingToken');
  const rewardToken = await deployments.get('RewardToken');

  // æ›´æ–°å‰ç«¯é…ç½®æ–‡ä»¶
  const configPath = '../frontend/src/config/contracts.ts';
  updateContractConfig(configPath, chainId, {
    TokenStaking: staking.address,
    StakingToken: stakingToken.address,
    RewardToken: rewardToken.address,
  });
};

func.tags = ['post-deploy'];
func.runAtTheEnd = true;
```

è¿™æ ·ï¼Œæ¯æ¬¡éƒ¨ç½²å®Œæˆåï¼Œå‰ç«¯é…ç½®ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ã€‚

### 3. å‰ç«¯æ„å»ºä¸å‘å¸ƒ

ä½¿ç”¨ shell è„šæœ¬å°è£…éƒ¨ç½²é€»è¾‘ï¼š

```bash
#!/bin/bash
# scripts/deploy.sh

TARGET=$1  # frontend | admin
ENV=$2     # preview | prod

# æ„å»º
pnpm build:$TARGET

# éƒ¨ç½²
if [ "$ENV" = "preview" ]; then
  firebase hosting:channel:deploy preview --only $TARGET
else
  firebase deploy --only hosting:$TARGET
fi
```

ä½¿ç”¨æ–¹å¼ï¼š
```bash
# éƒ¨ç½²å‰ç«¯åˆ°é¢„è§ˆç¯å¢ƒ
bash ./scripts/deploy.sh frontend preview

# éƒ¨ç½²ç®¡ç†åå°åˆ°æ­£å¼ç¯å¢ƒ
bash ./scripts/deploy.sh admin prod
```

### 4. æ–‡æ¡£ä¸é€šçŸ¥è‡ªåŠ¨åŒ–

å‘å¸ƒå®Œæˆåï¼Œè‡ªåŠ¨åˆ›å»º Notion æ–‡æ¡£å¹¶å‘é€ Telegram é€šçŸ¥ï¼š

```bash
# åˆ›å»º Notion é¡µé¢
curl -X POST 'https://api.notion.com/v1/pages' \
  -H "Authorization: Bearer $NOTION_TOKEN" \
  -H "Notion-Version: 2022-06-28" \
  -d '{
    "parent": { "page_id": "'$PARENT_PAGE_ID'" },
    "properties": {
      "title": { "title": [{ "text": { "content": "'$TITLE'" } }] }
    },
    "children": [...]
  }'

# å‘é€ Telegram é€šçŸ¥
curl -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
  -d '{
    "chat_id": "'$CHAT_ID'",
    "parse_mode": "Markdown",
    "text": "ğŸš€ *'$VERSION' å·²ä¸Šçº¿*\n\nğŸ“‹ [æŸ¥çœ‹æ–‡æ¡£]('$NOTION_URL')"
  }'
```

---

## å®Œæ•´æµç¨‹ç¤ºä¾‹

å®Œæ•´å‘å¸ƒæµç¨‹å¦‚ä¸‹ï¼š

```bash
# Step 1: æäº¤ä»£ç 
git add -A && git commit -m "feat: TokenStaking v1.0.0"

# Step 2: éƒ¨ç½²åˆçº¦
cd contracts
npx hardhat deploy --tags TokenStaking --network polygon

# Step 3: æ›´æ–°é…ç½®
npx hardhat deploy --tags post-deploy --network polygon

# Step 4: æ„å»ºå‰ç«¯
cd ../frontend
pnpm build:frontend && pnpm build:admin

# Step 5: éƒ¨ç½²åˆ°é¢„è§ˆç¯å¢ƒéªŒè¯
bash ./scripts/deploy.sh frontend preview
bash ./scripts/deploy.sh admin preview

# Step 6: éƒ¨ç½²åˆ°æ­£å¼ç¯å¢ƒ
bash ./scripts/deploy.sh frontend prod
bash ./scripts/deploy.sh admin prod

# Step 7: å‘å¸ƒæ–‡æ¡£å’Œé€šçŸ¥
# (é€šè¿‡ API è°ƒç”¨è‡ªåŠ¨å®Œæˆ)
```

æ•´ä¸ªè¿‡ç¨‹ä»å¼€å§‹åˆ°å®Œæˆï¼Œå¤§çº¦ 15 åˆ†é’Ÿã€‚

---

## äº§å‡ºç‰©

æ¯æ¬¡å‘å¸ƒå®Œæˆåï¼Œä¼šå¾—åˆ°ï¼š

| äº§å‡ºç‰© | è¯´æ˜ |
|--------|------|
| åˆçº¦åœ°å€ | éƒ¨ç½²åœ¨ç›®æ ‡é“¾ä¸Šçš„åˆçº¦åœ°å€ |
| å‰ç«¯åº”ç”¨ | ç”Ÿäº§ç¯å¢ƒ URL |
| ç®¡ç†åå° | ç®¡ç†åå° URL |
| é¢„è§ˆç¯å¢ƒ | ç”¨äºéªŒè¯çš„ä¸´æ—¶ç¯å¢ƒ |
| Notion æ–‡æ¡£ | åŒ…å«å®Œæ•´å‘å¸ƒä¿¡æ¯çš„æ–‡æ¡£ |
| Telegram é€šçŸ¥ | å‘é€åˆ°å›¢é˜Ÿç¾¤çš„é€šçŸ¥æ¶ˆæ¯ |
| æœ¬åœ°å˜æ›´æ—¥å¿— | ä¿å­˜åœ¨ä»£ç åº“ä¸­çš„ markdown æ–‡ä»¶ |

---

## ç»éªŒæ€»ç»“

### åšå¾—å¥½çš„åœ°æ–¹

1. **å¹‚ç­‰æ€§è®¾è®¡**ï¼šæ‰€æœ‰è„šæœ¬éƒ½å¯ä»¥é‡å¤è¿è¡Œï¼Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨
2. **é…ç½®è‡ªåŠ¨åŒæ­¥**ï¼šå‡å°‘äº†æ‰‹åŠ¨æ›´æ–°é…ç½®çš„é”™è¯¯
3. **é¢„è§ˆç¯å¢ƒéªŒè¯**ï¼šæ­£å¼å‘å¸ƒå‰æœ‰æœºä¼šå‘ç°é—®é¢˜
4. **æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ**ï¼šç¡®ä¿æ–‡æ¡£å’Œä»£ç ç‰ˆæœ¬ä¸€è‡´

### è¿˜å¯ä»¥æ”¹è¿›çš„åœ°æ–¹

1. **CI/CD é›†æˆ**ï¼šç›®å‰è¿˜æ˜¯æ‰‹åŠ¨è§¦å‘ï¼Œå¯ä»¥æ¥å…¥ GitHub Actions
2. **å›æ»šæœºåˆ¶**ï¼šéœ€è¦æ›´å®Œå–„çš„å›æ»šæµç¨‹
3. **ç›‘æ§å‘Šè­¦**ï¼šå‘å¸ƒåçš„ç›‘æ§è¿˜ä¸å¤Ÿå®Œå–„

---

## å†™åœ¨æœ€å

è‡ªåŠ¨åŒ–ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒç»­ä¼˜åŒ–çš„è¿‡ç¨‹ã€‚å»ºè®®æ˜¯ï¼š

1. **å…ˆè·‘é€šæ‰‹åŠ¨æµç¨‹**ï¼šç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯æ­£ç¡®çš„
2. **é€æ­¥è‡ªåŠ¨åŒ–**ï¼šä»æœ€å®¹æ˜“å‡ºé”™çš„ç¯èŠ‚å¼€å§‹
3. **ä¿æŒç®€å•**ï¼šä¸è¦è¿‡åº¦è®¾è®¡ï¼Œå¤Ÿç”¨å°±å¥½
4. **æŒç»­è¿­ä»£**ï¼šæ ¹æ®å®é™…ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ä¸æ–­ä¼˜åŒ–

å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿äº¤æµã€‚

---

## å‚è€ƒèµ„æº

- [Hardhat Deploy æ–‡æ¡£](https://github.com/wighawag/hardhat-deploy)
- [Firebase Hosting æ–‡æ¡£](https://firebase.google.com/docs/hosting)
- [Notion API æ–‡æ¡£](https://developers.notion.com/)
- [Telegram Bot API](https://core.telegram.org/bots/api)
