# 30 分钟构建你的第一个 AI Agent

> 快速上手创建具有工具使用能力的 AI Agent。

**日期**: 2024-12-28
**标签**: `agent` `教程` `入门`
**阅读时间**: 10 分钟

---

## 简介

在本教程中，我们将构建一个简单但功能完整的 AI Agent，它能够：
- 使用网络搜索回答问题
- 执行数学计算
- 读取和总结文件

## 前置条件

- Python 3.10+
- OpenAI API 密钥（或 Anthropic）
- Python 基础知识

## 第一步：环境设置

```bash
pip install openai requests
```

```python
import openai
import json

client = openai.OpenAI()
```

## 第二步：定义工具

```python
tools = [
    {
        "type": "function",
        "function": {
            "name": "calculate",
            "description": "执行数学计算",
            "parameters": {
                "type": "object",
                "properties": {
                    "expression": {"type": "string", "description": "数学表达式"}
                },
                "required": ["expression"]
            }
        }
    },
    {
        "type": "function",
        "function": {
            "name": "search_web",
            "description": "在网络上搜索信息",
            "parameters": {
                "type": "object",
                "properties": {
                    "query": {"type": "string", "description": "搜索查询"}
                },
                "required": ["query"]
            }
        }
    }
]
```

## 第三步：实现工具函数

```python
def calculate(expression: str) -> str:
    try:
        result = eval(expression)  # 注意：生产环境请使用更安全的方式
        return str(result)
    except Exception as e:
        return f"错误: {e}"

def search_web(query: str) -> str:
    # 简化实现 - 生产环境请使用真实的搜索 API
    return f"搜索结果: {query}"

tool_functions = {
    "calculate": calculate,
    "search_web": search_web
}
```

## 第四步：Agent 循环

```python
def run_agent(user_message: str):
    messages = [{"role": "user", "content": user_message}]

    while True:
        response = client.chat.completions.create(
            model="gpt-4",
            messages=messages,
            tools=tools
        )

        message = response.choices[0].message

        if message.tool_calls:
            for tool_call in message.tool_calls:
                func = tool_functions[tool_call.function.name]
                args = json.loads(tool_call.function.arguments)
                result = func(**args)

                messages.append(message)
                messages.append({
                    "role": "tool",
                    "tool_call_id": tool_call.id,
                    "content": result
                })
        else:
            return message.content
```

## 第五步：运行

```python
result = run_agent("42 * 17 等于多少？另外搜索一下 AI 的最新新闻")
print(result)
```

## 下一步

- 添加更多工具（文件读取、API 调用）
- 实现记忆以持久化上下文
- 添加错误处理和重试机制

## 总结

你已经构建了一个基础的 AI Agent！虽然简单，但这个模式可以扩展到复杂的应用场景。

---

**相关文章**:
- [理解 Agent 架构](./2024-12-29-Agent架构.md)
- [工具设计最佳实践](./2024-12-30-工具设计.md)

**书籍参考**: [Agent 开发指南 - 第四章](../../books/agent-development-guide/zh/04-工具使用.md)
